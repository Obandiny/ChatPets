<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <header class="header" [class.menu-open]="isMenuOpen" [class.menu-closed]="!isMenuOpen">
    <button class="btn-open-menu" aria-label="Abrir/Cerrar men칰" (click)="toggleMenu()">
      <mat-icon>{{ isMenuOpen ? 'menu_open' : 'menu' }}</mat-icon>
    </button>
    <h1 class="app-name">MASCOTAPP</h1>
  </header>

  <nav class="menu-lateral" *ngIf="isMenuOpen" role="navigation" aria-label="Men칰 lateral">
    <button class="btn-close-menu" (click)="toggleMenu()">Cerrar Men칰</button>

    <div class="group-btn">
      <a [routerLink]="['/menu']" routerLinkActive="active">Inicio</a>
      <a routerLink="/perfil" routerLinkActive="active">Perfil</a>
    </div>
  </nav>

  <div class="page-wrapper">
    <div class="header mat-elevation-z2">
      <div class="titulo-p">
        <h1>Diagn칩stico de Mascota</h1>
      </div>
      <div class="titulo-s">
        <h2>Por favor ingresa el estado de la mascota respondiendo las siguientes preguntas</h2>
      </div>
    </div>

    <div class="diagnostico-container">
      <mat-card class="question-card animate-slide" *ngIf="!mostrarResumen">
        <mat-card-title>{{ preguntaActualTexto }}</mat-card-title>

        <mat-form-field appearance="outline" color="accent" class="full-width">
          <mat-label>Respuesta</mat-label>
          <input
            matInput
            [(ngModel)]="currentAnswer"
            placeholder="Escribe tu respuesta"
            [type]="getInputType(preguntaActual)"
          />
        </mat-form-field>

        <button mat-stroked-button color="warn" (click)="abrirModal()">Ver datos de la mascota</button>

        <div class="button-group">
          <button mat-raised-button color="primary" (click)="before()" [disabled]="isFirstQuestion()">Anterior</button>
          <button mat-raised-button color="accent" (click)="next()" [disabled]="isAnswerEmpty()">Siguiente</button>
        </div>
      </mat-card>

      <mat-card class="question-card animate-slide" *ngIf="mostrarResumen">
        <mat-card-title>游늶 Revisi칩n de tus respuestas</mat-card-title>
        <mat-card-content>
          <div *ngFor="let fase of answers; let f = index">
            <p><strong>{{ fases[f].titulo }}</strong></p>
            <div *ngFor="let respuesta of fase; let i = index" class="resumen-item">
              <p><strong>{{ fases[f].preguntas[i] }}</strong></p>
              <p class="respuesta">游녤 {{ respuesta || 'Sin respuesta' }}</p>
              <mat-divider></mat-divider>
            </div>
          </div>
        </mat-card-content>

        <div class="button-group mt-2">
          <button mat-stroked-button color="primary" (click)="editarRespuestas()">Editar respuestas</button>
          <button mat-raised-button color="accent" (click)="finishDiagnosis()">Confirmar y enviar</button>
        </div>
      </mat-card>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="modalAbierto" (click)="cerrarModal()"></div>
  <div class="modal" *ngIf="modalAbierto">
    <mat-card class="modal-card">
      <mat-card-title>游냤 Informaci칩n de la Mascota</mat-card-title>
      <br>
      <mat-card-content>
        <table class="mascota-table">
          <tr>
            <td><strong>Nombre:</strong></td>
            <td *ngIf="!editandoMascota">{{ mascotaSeleccionada?.nombre }}</td>
            <td *ngIf="editandoMascota">
              <input [(ngModel)]="datosEditables.nombre" />
            </td>
          </tr>
          <tr>
            <td><strong>Edad:</strong></td>
            <td *ngIf="!editandoMascota">{{ mascotaSeleccionada?.edad }} a침os</td>
            <td *ngIf="editandoMascota">
              <input type="number" [(ngModel)]="datosEditables.edad" />
            </td>
          </tr>
          <tr>
            <td><strong>Raza:</strong></td>
            <td *ngIf="!editandoMascota">{{ mascotaSeleccionada?.raza }}</td>
            <td *ngIf="editandoMascota">
              <input [(ngModel)]="datosEditables.raza" />
            </td>
          </tr>
          <tr>
            <td><strong>Peso:</strong></td>
            <td *ngIf="!editandoMascota">{{ mascotaSeleccionada?.peso }} kg</td>
            <td *ngIf="editandoMascota">
              <input type="number" [(ngModel)]="datosEditables.peso" />
            </td>
          </tr>
        </table>
      </mat-card-content>
      <div class="button-group mt-2">
        <button mat-button color="warn" (click)="cerrarModal()">Cerrar</button>
        <button *ngIf="!editandoMascota" mat-button color="primary" (click)="activarEdicion()">Editar</button>
        <button *ngIf="editandoMascota" mat-button color="accent" (click)="guardarCambiosMascota()">Guardar cambios</button>
      </div>
    </mat-card>
  </div>

  <div class="fase-overlay" *ngIf="mostrarFaseOverlay">
    <h1>{{ fases[faseActual].titulo }}</h1>
  </div>
</body>
</html>
